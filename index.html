async function loadProducts(){
  const productSnapshot = await getDocs(query(collection(db,"products"),orderBy("code")));
  const variantSnapshot = await getDocs(collection(db,"variants"));

  let html="";

  for(const productDoc of productSnapshot.docs){

    let totalStock=0;
    let variantHTML="";

    for(const variantDoc of variantSnapshot.docs){
      const v=variantDoc.data();

      if(v.productId===productDoc.id){
        totalStock+=Number(v.stock);

        variantHTML+=`
          <tr>
            <td class="border p-1">${v.sku}</td>
            <td class="border p-1">${v.color}</td>
            <td class="border p-1">${v.importPrice}</td>
            <td class="border p-1">${v.salePrice}</td>
            <td class="border p-1 font-bold">${v.stock}</td>
          </tr>
        `;
      }
    }

    html+=`
      <div class="bg-white p-4 rounded shadow mb-6">
        <h3 class="font-bold text-lg">
          ${productDoc.data().name} (${productDoc.data().code})
        </h3>

        <p class="text-sm text-gray-600 mb-2">
          Tổng tồn kho: <span class="font-bold">${totalStock}</span>
        </p>

        <button onclick="addVariant('${productDoc.id}','${productDoc.data().code}')" 
          class="bg-blue-500 text-white px-3 py-1 rounded mb-3">
          Thêm biến thể
        </button>

        <table class="w-full border text-sm">
          <thead class="bg-gray-100">
            <tr>
              <th class="border p-1">SKU</th>
              <th class="border p-1">Màu</th>
              <th class="border p-1">Giá nhập</th>
              <th class="border p-1">Giá bán</th>
              <th class="border p-1">Tồn</th>
            </tr>
          </thead>
          <tbody>
            ${variantHTML || `<tr><td colspan="5" class="text-center p-2 text-gray-400">Chưa có biến thể</td></tr>`}
          </tbody>
        </table>
      </div>
    `;
  }

  document.getElementById("productList").innerHTML=html;
}
